<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.haebang.admin.dao.AdminDao">

<!-- 
	<resultMap type="memberVo" id="memberVo">
   </resultMap>
 -->
 	<!-- 해방회원 전체조회  -->
 	<select id="selectMemberList" resultType="memberVo">
 		select m_no, m_id, m_owner, m_phone, m_name, date_format(m_joinDate,'%Y-%m-%d') as m_joinDate, m_address
 		from t_member
 		where m_type = 'm'
 	</select>
 	<!-- 비회원 전체조회  -->
 	<select id="selectNoneMemberList" resultType="memberVo">
 		select m_no, m_id, m_owner, m_phone, m_name, date_format(m_joinDate,'%Y-%m-%d') as m_joinDate, m_address
 		from t_member
 		where m_type = 'b'
 	</select>
 	 <!-- 회원 조건 선택   -->
 	<select id="memberSelected" resultType="memberVo" parameterType="memberVo">
 		select m_no, m_id, m_owner, m_phone, m_name, date_format(m_joinDate,'%Y-%m-%d') as m_joinDate, m_address
 		from t_member
 		where 
 			m_type=#{m_type} 
			AND
 			<if test="m_id != null" >m_id like CONCAT('%',#{m_id},'%')</if>
 			<if test="m_name != null" >m_name like CONCAT('%',#{m_name},'%')</if>
 			<if test="m_phone != null" >m_phone like CONCAT('%',#{m_phone},'%')</if>
 			<if test="m_no != 0" >m_no = #{m_no}</if>
 	</select>
 	
 	
 	<!-- 해방업체리스트 전체 조회 -->  
 	<select id="selectHbCompanyList" resultType="hashMap">
 		select  c.c_name, e.e_name ,  c.c_address, c.c_phone, c.c_code, date_format(c.c_regDate,'%Y-%m-%d') as c_regDate, c.c_bizNo, c.c_empCnt
 		from t_company c, t_employee e
 		where 
 			c.c_code is not NULL
 			AND 
 			c.c_no = e.c_no
 			AND
 			e.e_type = 'O'
 	</select>
 	<!-- 일반업체리스트 전체 조회 -->
 	<select id="selectNCompanyList" resultType="hashMap">
 		select  e.e_name, c.c_name, c.c_address, c.c_phone, date_format(c_signDate, '%Y-%m-%d') as c_signDate, c.c_bizNo, c.c_empCnt
 		from t_company c, t_employee e
 		where 
 			c.c_code is NULL
 			AND 
 			c.c_no = e.c_no
 			AND
 			e.e_type = 'O'
 	</select>
  	<!-- 해방업체리스트 조건 검색 -->
 	<select id="searchHbCompanyList" resultType="hashMap" parameterType="companyVo">
 		select  c.c_name, e.e_name ,  c.c_address, c.c_phone, c.c_code, date_format(c.c_regDate,'%Y-%m-%d') as c_regDate, c.c_bizNo, c.c_empCnt
 		from t_company c, t_employee e
 		where
 			c_code is not NULL
 			AND 
 			c.c_no = e.c_no
 			AND
 			e.e_type = 'O'
 			AND
 			<if test="c_name != null" >c_name like CONCAT('%',#{c_name},'%')</if>
 			<if test="c_address != null" >c_address like CONCAT('%',#{c_address},'%')</if>
 			<if test="c_bizNo != null" >c_bizNo = #{c_bizNo}</if>
 			<if test="c_code != null" >c_code = #{c_code}</if>
 	</select>
 	<!-- 일반업체리스트 조건 검색 -->
 	<select id="searchNCompanyList" resultType="hashMap" parameterType="companyVo">
 		select  e.e_name, c.c_name, c.c_address, c.c_phone, date_format(c_signDate, '%Y-%m-%d') as c_signDate, c.c_bizNo, c.c_empCnt
 		from t_company c, t_employee e
 		where
 			c_code is NULL
 			AND 
 			c.c_no = e.c_no
 			AND
 			e.e_type = 'O'
 			AND
 			<if test="c_name != null" >c_name like CONCAT('%',#{c_name},'%')</if>
 			<if test="c_address != null" >c_address like CONCAT('%',#{c_address},'%')</if>
 			<if test="c_bizNo != null" >c_bizNo = #{c_bizNo}</if>
 	</select>
 
 	
 	<!-- 사업자 공지사항 리스트 조회   -->
 		<select id="getOwnerNoticeList" parameterType="java.util.Map" resultType="noticeBoardVo">
 			select n_no, n_writer, n_title, n_content, n_viewCnt, date_format( n_regDate, '%Y-%m-%d' ) as n_regDate, n_type
 			from t_notice
 			where
 				n_type = #{ n_type }
 				<if test="titlecontent != null">
	 				AND
 					(n_content like CONCAT('%',#{titlecontent},'%') or n_title like CONCAT('%',#{titlecontent},'%'))
 				</if>
 			order by n_no DESC
 			limit #{startPoint}, #{row}
 		</select> 
 	<!-- 사업자 공지사항 총 갯수  -->
 		<select id="selectTotalCount" parameterType="java.util.Map" resultType="Integer">
 			select count(*) 
 			from t_notice
 			where
 				n_type = #{ n_type }
 				<if test="titlecontent != null"> 
 					AND
 					(n_content like CONCAT('%',#{titlecontent},'%') or n_title like CONCAT('%',#{titlecontent},'%'))
 				</if>
 		</select>
 	<!-- 선택 공지사항 디테일  -->
		<select id="selectOneNDetailByNo" parameterType="noticeBoardVo" resultType="noticeBoardVo">
			 select n_no, n_writer, n_title, n_content, n_viewCnt, date_format( n_regDate, '%Y-%m-%d' ) as n_regDate, n_type
			 from t_notice 
			 where n_no = #{ n_no } 
		</select> 		
 	<!-- updateViewCnt ++   -->
 		<select id="updateViewCnt" parameterType="noticeBoardVo">
			update t_notice set n_viewCnt = #{n_viewCnt} where 	n_no = #{n_no}	
 		</select>
 	
 		<select id="insertNotice" parameterType="noticeBoardVo">
 			insert into t_notice(n_title, n_content, n_writer, n_type, n_fileOriName, n_fileSaveName)
 			values(#{n_title}, #{n_content}, #{n_writer}, #{n_type}, #{n_fileOriName}, #{n_fileSaveName})
 		</select>
 	<!-- 공지사항 업데이트  -->
 		<select id="updateNotice" parameterType="noticeBoardVo">
 			update t_notice 
 			set 
 				n_title = #{n_title}, n_content = #{n_content}, n_type = #{n_type} ,n_viewCnt = 0, n_regDate= now()
 			where
 				n_no = #{n_no} 
 		</select>
 		
 		<select id="deleteNotice" parameterType="Integer">
 			delete from t_notice where n_no = #{n_no}
 		</select>

<!-- 12/2일 지도 관련 주문정보 불러오기 창대 -->
 		<select id="selectAllMap" resultType="hashMap">
 		
<!--  		select t_m_order.mo_no, t_m_order.mo_orderNo, t_m_order.mo_startTime, t_e_order.eo_status, t_e_order.e_no, t_employee.e_name, t_member.m_name, t_member.m_address, t_member.m_lon, t_member.m_lat, t_member.m_gu
        from (((t_m_order inner join t_e_order on t_m_order.mo_no = t_e_order.mo_no)
        inner join t_member on t_m_order.m_no = t_member.m_no) inner join t_employee on t_employee.e_no = t_e_order.e_no) where date_format(t_m_order.mo_startTime, '%Y-%m-%d') = date_format(now(),'%Y-%m-%d');
 --> 
 	select allOrder.m_gu, allOrder.eo_status, count(allOrder.eo_status) as cnt from (select t_e_order.eo_status,  
	t_member.m_gu from 
	(((t_m_order inner join t_e_order on t_m_order.mo_no = t_e_order.mo_no)
       inner join t_member on t_m_order.m_no = t_member.m_no) 
       inner join t_employee on t_employee.e_no = t_e_order.e_no) 
       where date_format(t_m_order.mo_startTime, '%Y-%m-%d') = date_format(now(),'%Y-%m-%d') ) as allOrder group by m_gu, eo_status;
 		
 		</select>
 		
 	
</mapper>
